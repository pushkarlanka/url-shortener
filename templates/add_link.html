<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link href="{{ url_for('static', filename='bootstrap.min.css') }}" rel="stylesheet" media="screen">
    <script src="{{ url_for('static', filename='jquery-3.1.0.min.js')}}"></script>
    <script src="{{ url_for('static', filename='bootstrap.min.js')}}"></script>

    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">

</head>
<body>

{# boostrap starts    #}

    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Logo</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#about">ABOUT</a></li>
            <li><a href="#services">SERVICES</a></li>
            <li><a href="#portfolio">PORTFOLIO</a></li>
            <li><a href="#pricing">PRICING</a></li>
            <li><a href="#contact">CONTACT</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <style>

        .navbar {
            margin-bottom: 0;
            background-color: #f4511e;
            z-index: 9999;
            border: 0;
            font-size: 12px !important;
            line-height: 1.42857143 !important;
            letter-spacing: 4px;
            border-radius: 0;
        }

        .navbar li a, .navbar .navbar-brand {
            color: #fff !important;
        }

        .navbar-nav li a:hover, .navbar-nav li.active a {
            color: #f4511e !important;
            background-color: #fff !important;
        }

        .navbar-default .navbar-toggle {
            border-color: transparent;
            color: #fff !important;
        }

        .jumbotron {
            min-height: 60%;
            background-color: #3B5998;
            color: #ffffff;
        }

        .center {
            float: none;
            margin-left: auto;
            margin-right: auto;
        }

        body {
            background-color: #f6f6f6;
            font-family: 'Montserrat', sans-serif;
        }

        .footer {
            position: fixed;
            right: 0;
            bottom: 0;
            left: 0;
            padding: 1rem;
            background-color: #efefef;
            text-align: center;
        }

    </style>

    <div class="jumbotron text-center">

        <div class="container" style="padding-top: 5%">
            <h1>Your URL Hub.</h1>
            <p>Shorten, broadcast, analyze, repeat.</p>
        </div>

        <form id="form" class="form-inline" method="post" action="post_link">
            <input class="form-control" name="long_link" size="50" type="text" placeholder="Paste any link here" width="300px">
            <input class="btn btn-primary" type="submit" value="SHORTEN" >
        </form>

        <script type='text/javascript'>
            /* attach a submit handler to the form */
            $("#form").submit(function(event) {

                /* stop form from submitting normally */
                event.preventDefault();

                /* get the action attribute from the <form action=""> element */
                var $form = $( this ), url = $form.attr( 'action' );

                data = { long_link: $('input[name="long_link"]').val() };

                $.ajax({
                    url : url,
                    type: "POST",
                    data: JSON.stringify(data, null, '\t'),
                    contentType: 'application/json; charset=UTF-8',
                    success: function(data, textStatus, jqXHR)
                    {
                        var obj = JSON.parse(data);
                        console.log(obj['short_url']);
                        console.log(obj['long_url']);
                        console.log(obj['title']);

                        //data - response from server
                    },
                    error: function (jqXHR, textStatus, errorThrown)
                    {
                        alert('failure!');
                    }
                });

{#                $.getJSON(url, {#}
{#                    a: $('input[name="long_link"]').val(),#}
{#                }, function(data) {#}
{#                    alert('success');#}
{#                });#}
                return false;
            });
        </script>

    </div>

    <div id="panel_group" class="panel-group center" style="width: 60%;">
    </div>

    <div class="footer">Powered by Twitter Bootstrap | Developed by Pushkar Lanka</div>

{#    <div class="alert alert-danger">#}
{#        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>#}
{#        <strong>Danger!</strong> Indicates a dangerous or potentially negative action.#}
{#    </div>#}

{# bootsrap ends #}

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for m in messages %}
                <script>

                    if(('{{ m }}').localeCompare('error') == 0) {
                        console.log('INVALID URL');
                    } else {
                        console.log("LOOK" + {{ m|tojson|safe }});
                        // initialize local storage if NULL
                        var data;
                        if(localStorage.getItem('session_data') == null) {
                            data = {'body': []};
                        } else {
                            data = JSON.parse(localStorage.getItem('session_data'));
                        }

                        data['body'].push(JSON.parse({{ m|tojson|safe }}));
                        localStorage.setItem('session_data', JSON.stringify(data));
                    }


                </script>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <script>
        $(document).ready(function() {

            console.log("SESSION DATA: " +  localStorage.getItem('session_data'));
            var data = JSON.parse(localStorage.getItem('session_data'));
            if(data && data['body'] && data['body'].length > 0) {
                data = data['body'];
                for(var i = data.length - 1; i >= 0; i--) {
                    var item = data[i];

                    var panel = document.createElement('div');
                    panel.className = "panel panel-primary";

                    var panel_heading = document.createElement('div');
                    panel_heading.className = "panel-heading";
                    panel_heading.textContent = item['title'];

                    var panel_body = document.createElement('div');
                    panel_body.className = "panel-body";
                    var short_url = document.createElement('a');
                    short_url.href = item['short_url'];
                    short_url.text = item['short_url'];
                    panel_body.appendChild(short_url);

                    panel.appendChild(panel_heading);
                    panel.appendChild(panel_body);
                    document.getElementById("panel_group").appendChild(panel);

                }
            } else {
                var div = document.createElement('div');
                div.className = 'text-center';
                div.style = 'padding-top: 10%';
                var text = document.createElement('strong');
                text.style = 'color: grey; font-size: 30px;';
                text.textContent = "No links to show";
                div.appendChild(text);
                document.body.appendChild(div);
            }
        });
    </script>

    {#TODO: Use AJAX to get URL info instead of refreshing page#}
{#        <div class="panel panel-info">#}
{#            <div class="panel-heading">Panel with panel-primary class</div>#}
{#            <div class="panel-body">Panel Content</div>#}
{#        </div>#}

</body>
</html>